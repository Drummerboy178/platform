name: Test
on:
  workflow_dispatch:
jobs:
  run:
    runs-on: windows-latest
    steps:
      - run: |
          # INSTALL LICENSE
          mkdir -p ~/.vaadin/
          echo '{"username":"'`echo ${{secrets.TB_LICENSE}} | cut -d / -f1`'","proKey":"'`echo ${{secrets.TB_LICENSE}} | cut -d / -f2`'"}' > ~/.vaadin/proKey
        shell: bash
      - uses: browser-actions/setup-chrome@latest
        with:
          chrome-version: stable
      - uses: actions/setup-node@v4
        with:
          node-version: '22.12'
      - uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'
      - uses: stCarolas/setup-maven@v5
        with:
          maven-version: '3.9.0'
      - run: |
          # Show commands
          set -x
          where node.exe || true
          where node || true
          # Clean stuff
          rm -rf ~/.m2/repository/
          rm -rf ~/.vaadin/node/
          # Clone repo
          git clone https://github.com/vaadin/designer-tutorial.git
          cd designer-tutorial
          # Change version
          perl -pi -e 's|(\s*<'vaadin.version'>)[^\s]+(</'vaadin.version'>)|${1}24.7.0.alpha1${2}|g' pom.xml
          # Set debug level
          echo "logging.level.com.vaadin.exampledata.NodeUtil=debug" >> src/main/resources/application.properties
          echo "logging.level.com.vaadin.flow.server.frontend=debug" >> src/main/resources/application.properties
          # Prepare frontend
          mvn vaadin:prepare-frontend -ntp -B -X || true
          ls -l ~/.vaadin/node/ || true
          where node.exe || true
          where node || true
          ~/.vaadin/node/node -v || true
          ~/.vaadin/node/node.exe -v || true
          ~/.vaadin/node/node --version || true
          ~/.vaadin/node/node.exe --version || true
          # Build
          mvn -ntp -B -X || true
        shell: bash
